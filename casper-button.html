<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-spinner/paper-spinner-lite.html">
<link rel="import" href="../vaadin-progress-bar/vaadin-progress-bar.html">


<dom-module id="casper-button">
  <template>

    <style>
      :host {
        display: block;
        --lumo-primary-color: var(--primary-color);
      }

      paper-button{
        width: 100%;
        text-align: center;
        background-color: var(--primary-color);
        color: white;
        margin: 0px;
        padding: 0;
        transition: background-color 0.5s;
      }

      paper-button:hover {
        background: var(--dark-primary-color);
        transition: background-color 0.5s;
      }

      paper-button[disabled] {
        background: #eaeaea;
        color: #a8a8a8;
        cursor: auto;
        pointer-events: none;
        transition: background-color 0.5s;
      }

      vaadin-progress-bar{
        margin: 0px;
        height: 40px;
      }

      paper-button {
        position: relative;
        overflow: hidden;
      }
      paper-button paper-spinner-lite {
        position: absolute;
        top: 8px;
        left: 49%;
        width: 22px;
        height: 22px;
        --paper-spinner-color: white;
        --paper-spinner-stroke-width: 4px;
      }

      paper-button #submitText{
        position: absolute;
      }

      paper-button.decline-button {
        background: #bdbdbd;
      }

      paper-button.decline-button:hover {
        background-color: #8e8e8e;
      }

    </style>
    <paper-button>
      <paper-spinner-lite id="spin"></paper-spinner-lite>
      <span id="submitText" class='text'>
        <slot name="text-button">Concordo e aceito</slot>
      </span>
      <vaadin-progress-bar value="0" id="progress_bar" value="0"></vaadin-progress-bar>
    </paper-button>
  </template>

  <script>
    /**
     * `casper-button`
     * click, click, click...
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class CasperButton extends Polymer.Element {
      static get is() { return 'casper-button'; }
      static get properties() {
        return {
          progress: {
            type: String,
            value: 0,
            observer: '_progressChanged'
          },
          disabled: {
            type: Boolean,
            observer: '_disabledChanged'
          },
          css_class: {
            type: String
          }

        };
      }

      connectedCallback() {
        super.connectedCallback();
      }

      ready() {
        super.ready();
        if(this.css_class != undefined){
          this.shadowRoot.querySelector("paper-button").classList.add(this.css_class);
        }
      }

      _disabledChanged(newValue, oldValue) {
        this.shadowRoot.querySelector("paper-button").disabled = newValue;
      }

      _progressChanged(newValue, oldValue){

        if(newValue == 0){
          this.$.spin.active = false;
          this.$.submitText.style.display = 'inline-block';
        }
        this.$.progress_bar.value = newValue / 100;
      }
    }



    window.customElements.define(CasperButton.is, CasperButton);
  </script>
</dom-module>
